import{u as U,q as T,r as y,s as u,j as e,U as N,ao as P,ap as $,W as z,D as C,R as w,C as H,M as Q,V as D,b as V}from"./react-vendor--vquuSlV.js";import{u as W,C as d,a as o,B as v,L as J,b as i,c as x,d as E,f as X,e as K,g as p}from"./index-CWe1EfRc.js";const re=()=>{const{t:s}=U(),n=T(),{user:k}=W(),[l,B]=y.useState(null),{data:a,isLoading:q,error:O}=u({queryKey:["groups"],queryFn:async()=>(await p.get("/groups")).data.data,retry:1}),{data:A,isLoading:L,error:S}=u({queryKey:["friends"],queryFn:async()=>(await p.get("/friends/my")).data,retry:1}),{data:b}=u({enabled:!!a?.groups?.length,queryKey:["all-groups-balances",a?.groups?.map(r=>r._id).join(",")],queryFn:async()=>{const r={};return a?.groups&&await Promise.all(a.groups.map(async t=>{try{const m=await p.get(`/settle/${t._id}/balances`);r[t._id]=m.data.data.balances||[]}catch{r[t._id]=[]}})),r}});y.useEffect(()=>{!l&&a?.groups?.length&&B(a.groups[0]._id)},[l,a]);const{data:g,isLoading:I}=u({enabled:!!l,queryKey:["dashboard-expenses",l],queryFn:async()=>(await p.get(`/expenses/${l}?page=1&limit=5&sortBy=createdAt&sortOrder=desc`)).data.data}),R=q||L||I,_=O||S,c=y.useMemo(()=>{if(!b||!a?.groups)return{totalOwe:0,totalOwed:0,netBalance:0};let r=0,t=0;const m=k?._id?.toString();return a.groups.forEach(F=>{const M=(b[F._id]||[]).find(f=>(f.userId?._id?.toString()||f.userId?.toString()||f.userId)===m),h=parseFloat(M?.balance||0);h<0&&(r+=Math.abs(h)),h>0&&(t+=h)}),{totalOwe:r,totalOwed:t,netBalance:t-r}},[b,a,k]),j=r=>K(r||0,"MAD");if(_)return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:s("dashboard.title")}),e.jsx("p",{className:"text-muted-foreground",children:s("dashboard.subtitle")})]}),e.jsx(d,{className:"rounded-xl border-border shadow-soft",children:e.jsxs(o,{className:"text-center py-12",children:[e.jsx("p",{className:"text-destructive mb-4",children:s("errors.serverError")}),e.jsx(v,{className:"rounded-xl font-medium mt-4",onClick:()=>window.location.reload(),children:s("common.retry")})]})})]});const G=[{icon:w,titleKey:"dashboard.addExpense",descKey:"dashboard.addExpenseDesc",onClick:()=>n("/expenses"),color:"from-blue-500 to-blue-600"},{icon:N,titleKey:"dashboard.createGroup",descKey:"dashboard.createGroupDesc",onClick:()=>n("/groups"),color:"from-indigo-500 to-indigo-600"},{icon:H,titleKey:"dashboard.settleUp",descKey:"dashboard.settleUpDesc",onClick:()=>n("/settle"),color:"from-green-500 to-green-600"},{icon:Q,titleKey:"dashboard.groupChat",descKey:"dashboard.groupChatDesc",onClick:()=>n("/chat"),color:"from-purple-500 to-purple-600"}];return R?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(J,{size:"lg"})}):a?.groups?.length?e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground tracking-tight",children:s("dashboard.title")}),e.jsx("p",{className:"text-muted-foreground mt-2 text-sm sm:text-base",children:s("dashboard.subtitle")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 sm:gap-6",children:[e.jsxs(d,{className:"rounded-xl border border-border shadow-soft border-l-4 border-l-destructive hover:shadow-soft-lg transition-shadow",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:s("dashboard.youOwe")}),e.jsx($,{className:"h-5 w-5 text-red-600 dark:text-red-400"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:j(c.totalOwe)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("dashboard.youOweDesc")})]})]}),e.jsxs(d,{className:"rounded-xl border border-border shadow-soft border-l-4 border-l-green-500 dark:border-l-green-600 hover:shadow-soft-lg transition-shadow",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:s("dashboard.youShouldReceive")}),e.jsx(z,{className:"h-5 w-5 text-green-600 dark:text-green-400"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:j(c.totalOwed)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("dashboard.youShouldReceiveDesc")})]})]}),e.jsxs(d,{className:"rounded-xl border border-border shadow-soft border-l-4 border-l-primary hover:shadow-soft-lg transition-shadow",children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:s("dashboard.netBalance")}),e.jsx(C,{className:"h-5 w-5 text-primary"})]}),e.jsxs(o,{children:[e.jsx("div",{className:`text-3xl font-bold ${c.netBalance>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:j(c.netBalance)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:c.netBalance>=0?s("dashboard.netBalanceDescOwed"):s("dashboard.netBalanceDescOwe")})]})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-4",children:s("dashboard.quickActions")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:G.map((r,t)=>e.jsx(d,{className:"rounded-xl border border-border shadow-soft hover:border-primary/50 dark:hover:border-primary/40 hover:shadow-soft-lg transition-all cursor-pointer group",onClick:r.onClick,children:e.jsxs(o,{className:"p-5 sm:p-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary/10 flex items-center justify-center mb-4 group-hover:scale-105 transition-transform",children:e.jsx(r.icon,{className:"h-6 w-6 text-primary"})}),e.jsx("h3",{className:"font-semibold text-foreground mb-1",children:s(r.titleKey)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s(r.descKey)}),e.jsx(D,{className:"h-4 w-4 text-muted-foreground mt-3 group-hover:text-primary group-hover:translate-x-1 transition-all"})]})},t))})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(d,{children:[e.jsxs(i,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5"}),s("dashboard.recentExpenses")]}),e.jsx(E,{children:s("dashboard.recentExpensesDesc")})]}),e.jsxs(o,{children:[e.jsx("div",{className:"space-y-3",children:g?.expenses?.length?g.expenses.map(r=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 p-3 sm:p-4 rounded-xl border border-border hover:border-primary/40 dark:hover:border-primary/50 hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold truncate",children:r.description}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2 mt-1 flex-wrap",children:[e.jsx("span",{children:X(r.createdAt)}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:r.category})]})]}),e.jsxs("div",{className:"text-start sm:text-end shrink-0",children:[e.jsx("p",{className:"font-bold text-lg",children:K(r.amount,r.currency||"MAD")}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["by ",r.payerId?.username||s("common.unknown")]})]})]},r._id)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(w,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:s("expenses.noExpenses")})]})}),g?.expenses?.length>0&&e.jsxs(v,{variant:"outline",className:"w-full mt-4 rounded-xl",onClick:()=>n("/expenses"),children:[s("dashboard.viewAllExpenses"),e.jsx(D,{className:"ms-2 h-4 w-4"})]})]})]}),e.jsxs(d,{className:"rounded-xl border border-border shadow-soft",children:[e.jsxs(i,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5"}),s("dashboard.overview")]}),e.jsx(E,{children:s("dashboard.accountSummary")})]}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl bg-primary/10 dark:bg-primary/20 border border-primary/20 dark:border-primary/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary/20 dark:bg-primary/30 flex items-center justify-center",children:e.jsx(N,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s("dashboard.groupsLabel")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("dashboard.groupsDesc")})]})]}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:a?.groups?.length||0})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl bg-secondary/50 dark:bg-secondary border border-border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-secondary dark:bg-secondary/80 flex items-center justify-center",children:e.jsx(V,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:s("dashboard.friendsLabel")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("dashboard.friendsDesc")})]})]}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:A?.length||0})]})]})})]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground tracking-tight",children:s("dashboard.title")}),e.jsx("p",{className:"text-muted-foreground mt-2 text-sm",children:s("dashboard.subtitle")})]}),e.jsx(d,{className:"rounded-xl border border-dashed border-border",children:e.jsxs(o,{className:"text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl bg-primary/10 flex items-center justify-center mx-auto mb-6",children:e.jsx(N,{className:"h-8 w-8 text-primary"})}),e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:s("dashboard.noGroups")}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto text-sm leading-relaxed",children:s("dashboard.createFirstGroup")}),e.jsxs(v,{onClick:()=>n("/groups"),className:"rounded-xl font-medium",children:[e.jsx(P,{className:"me-2 h-4 w-4"}),s("dashboard.createGroup")]})]})})]})};export{re as default};
