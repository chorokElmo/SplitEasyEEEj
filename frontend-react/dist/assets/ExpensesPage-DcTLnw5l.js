import{u as $e,r as u,v as Pe,s as te,w as de,j as e,U as R,J as Ue,ao as Ne,D as ue,W as we,B as me,aq as be,ar as Ie,as as ze,at as Be,au as Je,av as Xe,aw as Se,ax as Ye,ay as He,az as We,aA as Ze,aB as Ve,aC as es,Z as pe,X as Ce,aD as Ee,a3 as ss,aE as ts,z as rs,aF as as,aG as ns}from"./react-vendor--vquuSlV.js";import{u as os,h as is,g as K,L as xe,C as A,a as k,B as y,e as M,b as re,c as ae,d as De,I as G,i as he,j as qe,f as ls}from"./index-CWe1EfRc.js";import{D as cs,a as ds}from"./dialog-BKDal8hE.js";const us=20,B=["Food & Dining","Transportation","Shopping","Entertainment","Bills & Utilities","Travel","Health & Fitness","Education","General","Groceries","Restaurant","Gas","Rent","Insurance"],Ae=["#3b82f6","#8b5cf6","#ec4899","#f59e0b","#10b981","#ef4444","#06b6d4","#84cc16"],gs=()=>{const{t:r}=$e(),[O,ge]=u.useState(""),[F,fe]=u.useState(""),[$,P]=u.useState(1),[l,ye]=u.useState(""),[C,U]=u.useState(!1),[v,J]=u.useState(null),[j,ne]=u.useState(""),[m,X]=u.useState("equal"),[b,L]=u.useState([]),[Y,ke]=u.useState(!0),{user:D}=os(),{toast:I}=is(),p=Pe(),[o,S]=u.useState({description:"",amount:"",category:"General",note:"",expenseDate:new Date().toISOString().slice(0,16),payerId:""}),[g,q]=u.useState([]),{data:Q,isLoading:Fe}=te({queryKey:["groups"],queryFn:async()=>{try{return(await K.get("/groups")).data.data}catch(s){return console.error("Error fetching groups:",s),{groups:[]}}},retry:2}),{data:H}=te({enabled:!!l,queryKey:["group",l],queryFn:async()=>{try{return(await K.get(`/groups/${l}`)).data.data.group}catch(s){return console.error("Error fetching group details:",s),null}},retry:2}),oe=H?.currency||"USD",{data:ie}=te({enabled:!!j&&C,queryKey:["group",j],queryFn:async()=>{try{return(await K.get(`/groups/${j}`)).data.data.group}catch(s){return console.error("Error fetching form group details:",s),null}},retry:2}),je=ie?.currency||"USD",x=ie?.members||[];u.useEffect(()=>{!l&&Q?.groups?.length&&ye(Q.groups[0]._id)},[Q,l]);const _=C&&j?ie:H,W=C&&j?je:oe,_e=j&&C?x:H?.members||[];u.useEffect(()=>{if(!(!C||!j)&&x.length){const s=x.map(t=>t.userId._id||t.userId);q(s),S(t=>({...t,payerId:t.payerId||D?._id||s[0]}))}},[C,j,x.length,D?._id]),u.useEffect(()=>{if(m==="equal"){L([]);return}if(m==="custom"){const s=_e.filter(i=>{const n=(i.userId?._id||i.userId)?.toString?.();return g.some(a=>(a?.toString?.()||a)===n)}),t=parseFloat(o.amount||v?.amount||0);if(s.length>0&&t>0){const i=t/s.length;L(s.map(n=>({userId:n.userId._id||n.userId,username:n.userId.username,shareAmount:i.toFixed(2)})))}}},[m,g]);const{data:N,isLoading:Te,isError:Ke,error:Me,refetch:ms}=te({enabled:!!l&&l.length>0,queryKey:["expenses",l,$,F],queryFn:async()=>{try{if(!l||!/^[0-9a-fA-F]{24}$/.test(l))throw new Error("Invalid group ID");const s=new URLSearchParams({page:$.toString(),limit:us.toString(),sortBy:"createdAt",sortOrder:"desc"});F&&s.append("category",F);const t=await K.get(`/expenses/${l}?${s}`);return console.log("Expenses fetched:",t.data.data),t.data.data}catch(s){throw console.error("Error fetching expenses:",s),console.error("Error details:",{status:s.response?.status,data:s.response?.data,selectedGroup:l}),s}},retry:(s,t)=>t?.response?.status===400?!1:s<2,refetchOnWindowFocus:!1,staleTime:0}),w=u.useMemo(()=>{const s=N?.expenses||[],t=s.reduce((d,h)=>d+(parseFloat(h.amount)||0),0),i=s.length>0?t/s.length:0,n=s.reduce((d,h)=>{const T=h.category||"General";return d[T]=(d[T]||0)+(parseFloat(h.amount)||0),d},{}),a=Object.entries(n).map(([d,h])=>({name:d,value:parseFloat(h)})).sort((d,h)=>h.value-d.value).slice(0,8),c=s.reduce((d,h)=>{const T=new Date(h.createdAt),ve=`${T.getFullYear()}-${String(T.getMonth()+1).padStart(2,"0")}`;return d[ve]=(d[ve]||0)+(parseFloat(h.amount)||0),d},{}),E=Object.entries(c).sort(([d],[h])=>d.localeCompare(h)).slice(-6).map(([d,h])=>({name:new Date(d+"-01").toLocaleDateString("en-US",{month:"short",year:"numeric"}),amount:parseFloat(h)})),ce=s.reduce((d,h)=>{const T=h.payerId?.username||"Unknown";return d[T]=(d[T]||0)+(parseFloat(h.amount)||0),d},{}),f=Object.entries(ce).map(([d,h])=>({name:d,value:parseFloat(h)})).sort((d,h)=>h.value-d.value);return{totalSpent:t,avgExpense:i,totalCount:s.length,categoryData:a,monthlyChartData:E,payerData:f,currency:oe}},[N,oe]),Ge=u.useMemo(()=>{const t=(N?.expenses||[]).slice(0,10).map(n=>n.category).filter(Boolean),i=[...new Set(t)];return[...i,...B.filter(n=>!i.includes(n))].slice(0,8)},[N]),Z=de({mutationFn:async()=>{if(!o.description?.trim())throw new Error("Description is required");if(!o.amount||Number(o.amount)<=0)throw new Error("Amount must be greater than 0");const s=j||l;if(!s)throw new Error("Please select a group");if(!/^[0-9a-fA-F]{24}$/.test(s))throw new Error("Invalid group ID format");const t=parseFloat(o.amount);if(isNaN(t)||t<=0)throw new Error("Amount must be a positive number");const i=je.toUpperCase().trim().slice(0,3)||"USD",n={description:o.description.trim(),amount:t,currency:i,category:(o.category||"General").trim(),groupId:s,splitType:m==="custom"?"exact":"equal",payerId:o.payerId||D?._id};if(m==="equal"&&g.length>0&&(n.splitMemberIds=g.map(a=>a?.toString?.()||a)),o.expenseDate&&(n.expenseDate=new Date(o.expenseDate).toISOString()),o.note?.trim()&&(n.note=o.note.trim()),m==="custom"&&b.length>0){const a=g.map(f=>f?.toString?.()||f),c=b.filter(f=>a.includes(f.userId?.toString?.()||f.userId)),E=t,ce=c.reduce((f,d)=>f+parseFloat(d.shareAmount||0),0);if(Math.abs(E-ce)>=.01)throw new Error("Split amounts must match the total amount");if(n.splits=c.filter(f=>f.userId&&/^[0-9a-fA-F]{24}$/.test(f.userId?.toString?.()||f.userId)).map(f=>({userId:f.userId,shareAmount:parseFloat(f.shareAmount)})),n.splits.length===0)throw new Error("At least one valid split is required for custom split")}console.log("ðŸ“¤ Creating expense with payload:",JSON.stringify(n,null,2));try{const a=await K.post("/expenses",n);return console.log("âœ… Expense created successfully:",a.data),a.data}catch(a){throw console.error("âŒ API call failed:",a),console.error("Request URL:",`${K.defaults.baseURL}/expenses`),console.error("Request payload:",JSON.stringify(n,null,2)),console.error("Error response status:",a.response?.status),console.error("Error response data:",a.response?.data),a}},onSuccess:()=>{I({title:r("expenses.added"),description:r("expenses.splitSuccess",{type:r(m==="equal"?"expenses.equal":"expenses.custom")})}),p.invalidateQueries({queryKey:["expenses"]}),P(1),p.invalidateQueries({queryKey:["balances"]}),p.invalidateQueries({queryKey:["all-groups-balances"]}),p.invalidateQueries({queryKey:["groupSettlements"]}),p.invalidateQueries({queryKey:["settlements"]}),p.invalidateQueries({queryKey:["group",l]}),setTimeout(()=>{p.refetchQueries({queryKey:["expenses",l],exact:!1})},300),ee()},onError:s=>{console.error("=== EXPENSE CREATION ERROR ===",s),console.error("Error response:",s.response),console.error("Error response data:",s.response?.data),console.error("Error response status:",s.response?.status);let t=r("errors.unknownError"),i=r("expenses.addFailed");if(s.response?.data){const n=s.response.data;n.message&&n.message!=="Validation error"?t=n.message:n.errors&&Array.isArray(n.errors)&&n.errors.length>0?t=n.errors.map(a=>typeof a=="string"?a:a.message?`${a.field||"Field"}: ${a.message}`:a.field?`${a.field}: validation failed`:JSON.stringify(a)).join("; "):n.error?t=n.error:n.message&&(t=n.message),s.response.status===400?i=r("errors.validationError"):s.response.status===403?(i="Authorization Error",(!t||t===r("errors.unknownError"))&&(t="You are not authorized to perform this action")):s.response.status===404&&(i="Not Found",(!t||t===r("errors.unknownError"))&&(t="Resource not found"))}else s.message&&(t=s.message,(s.message.includes("Network")||s.message.includes("timeout"))&&(i="Connection Error"));console.error("Final error message:",t),console.error("Payload that failed:",{description:o.description,amount:o.amount,category:o.category,groupId:l,splitType:m,customSplits:b}),I({variant:"destructive",title:i,description:t,duration:5e3})}}),V=de({mutationFn:async({id:s,data:t})=>(await K.put(`/expenses/${s}`,t)).data,onSuccess:()=>{I({title:r("expenses.updated"),description:r("notifications.success")}),p.invalidateQueries({queryKey:["expenses"]}),p.invalidateQueries({queryKey:["balances"]}),p.invalidateQueries({queryKey:["all-groups-balances"]}),p.invalidateQueries({queryKey:["groupSettlements"]}),p.invalidateQueries({queryKey:["settlements"]}),p.invalidateQueries({queryKey:["group",l]}),setTimeout(()=>{p.refetchQueries({queryKey:["expenses",l],exact:!1})},300),J(null),ee()},onError:s=>{let t=s.message||r("errors.unknownError");s.response?.data&&(s.response.data.message?t=s.response.data.message:s.response.data.errors&&Array.isArray(s.response.data.errors)?t=s.response.data.errors.map(i=>i.message||i.field).join(", "):s.response.data.error&&(t=s.response.data.error)),console.error("Update expense error:",{status:s.response?.status,message:t,data:s.response?.data}),I({variant:"destructive",title:s.response?.status===400?r("errors.validationError"):r("expenses.updateFailed"),description:t})}}),Oe=de({mutationFn:async s=>(await K.delete(`/expenses/${s}`)).data,onSuccess:()=>{I({title:r("expenses.deleted"),description:r("notifications.success")}),p.invalidateQueries({queryKey:["expenses"]}),p.invalidateQueries({queryKey:["balances"]}),p.invalidateQueries({queryKey:["all-groups-balances"]}),p.invalidateQueries({queryKey:["groupSettlements"]}),p.invalidateQueries({queryKey:["settlements"]}),p.invalidateQueries({queryKey:["group",l]}),setTimeout(()=>{p.refetchQueries({queryKey:["expenses",l],exact:!1})},300)},onError:s=>{let t=s.message||r("errors.unknownError");s.response?.data&&(s.response.data.message?t=s.response.data.message:s.response.data.errors&&Array.isArray(s.response.data.errors)?t=s.response.data.errors.map(i=>i.message||i.field).join(", "):s.response.data.error&&(t=s.response.data.error)),console.error("Delete expense error:",{status:s.response?.status,message:t,data:s.response?.data}),I({variant:"destructive",title:s.response?.status===400?r("errors.validationError"):r("expenses.deleteFailed"),description:t})}}),ee=u.useCallback(()=>{S({description:"",amount:"",category:"General",note:"",expenseDate:new Date().toISOString().slice(0,16),payerId:""}),q([]),X("equal"),L([]),U(!1),J(null)},[]),Le=u.useCallback(s=>{J(s);const t=s.groupId?._id??s.groupId;ne(t||l);const i=s.expenseDate?new Date(s.expenseDate).toISOString().slice(0,16):s.createdAt?new Date(s.createdAt).toISOString().slice(0,16):new Date().toISOString().slice(0,16),n=s.payerId?._id??s.payerId;S({description:s.description||"",amount:s.amount?.toString()||"",category:s.category||"General",note:s.note||"",expenseDate:i,payerId:n||D?._id}),X(s.splitType==="exact"?"custom":s.splitType||"equal"),s.splits&&s.splits.length>0?(q(s.splits.map(a=>a.userId?._id??a.userId)),L(s.splits.map(a=>({userId:a.userId._id||a.userId,username:a.userId?.username||"Unknown",shareAmount:a.shareAmount?.toString()||"0"})))):q([]),U(!0)},[l,D?._id]);u.useEffect(()=>{v&&x.length>0&&g.length===0&&q(x.map(s=>s.userId._id||s.userId))},[v,x,g.length]);const Qe=u.useCallback(()=>{if(!o.description?.trim()){I({variant:"destructive",title:r("errors.validationError"),description:r("expenses.description")+" "+r("errors.required")});return}if(!o.amount||Number(o.amount)<=0){I({variant:"destructive",title:r("errors.validationError"),description:r("expenses.amount")+" "+r("errors.mustBePositive")});return}if(m==="custom"&&!z()){I({variant:"destructive",title:r("errors.validationError"),description:r("expenses.amountsDontMatch")});return}if(v){const s={description:o.description.trim(),amount:Number(o.amount),currency:W.toUpperCase().trim().slice(0,3)||"USD",category:o.category.trim()||"General",splitType:m==="custom"?"exact":"equal",note:o.note?.trim()||"",payerId:o.payerId||D?._id},t=v.groupId?._id??v.groupId;if(j&&j!==t&&(s.groupId=j),o.expenseDate&&(s.expenseDate=new Date(o.expenseDate).toISOString()),m==="equal"&&g.length>0&&(s.splitMemberIds=g.map(i=>i?.toString?.()||i)),m==="custom"&&b.length>0){const i=g.map(n=>n?.toString?.()||n);s.splits=b.filter(n=>i.includes(n.userId?.toString?.()||n.userId)).map(n=>({userId:n.userId,shareAmount:Number(n.shareAmount)}))}V.mutate({id:v._id,data:s})}else{if(!j&&!l){I({variant:"destructive",title:r("errors.validationError"),description:r("expenses.noGroupSelected")});return}Z.mutate()}},[o,m,b,v,l,j,Z,V,I,r]),z=u.useCallback(()=>{if(m==="custom"){const s=parseFloat(o.amount||v?.amount||0),t=b.reduce((i,n)=>i+parseFloat(n.shareAmount||0),0);return Math.abs(s-t)<.01}return!0},[m,o.amount,v,b]),le=u.useMemo(()=>{let s=N?.expenses||[];if(O){const t=O.toLowerCase();s=s.filter(i=>i.description?.toLowerCase().includes(t)||i.category?.toLowerCase().includes(t)||i.payerId?.username?.toLowerCase().includes(t)||i.note?.toLowerCase().includes(t))}return s},[N,O]),Re=u.useMemo(()=>{const s=new Set;return N?.expenses?.forEach(t=>{t.category&&s.add(t.category)}),Array.from(s).sort()},[N]),se=N?.totalPages||1;return Fe?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(xe,{size:"lg"})}):Q?.groups?.length?e.jsxs("div",{className:"space-y-6 animate-in fade-in duration-300",children:[Ke&&e.jsx(A,{className:"border-red-200 bg-red-50 animate-in slide-in-from-top",children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ue,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-red-800",children:r("errors.serverError")}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:Me?.message||r("errors.unknownError")})]}),e.jsx(y,{size:"sm",variant:"outline",onClick:()=>{p.invalidateQueries({queryKey:["expenses",l]})},children:r("common.retry")})]})})}),e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-primary to-purple-600 bg-clip-text text-transparent",children:r("expenses.title")}),e.jsx("p",{className:"text-muted-foreground mt-1",children:r("expenses.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("label",{className:"text-sm text-muted-foreground whitespace-nowrap",children:r("expenses.selectGroup")}),e.jsx("select",{className:"border rounded-md px-3 py-2 bg-background text-sm min-w-[150px] focus:outline-none focus:ring-2 focus:ring-primary",value:l,onChange:s=>{ye(s.target.value),P(1),ge(""),fe("")},children:Q?.groups?.map(s=>e.jsx("option",{value:s._id,children:s.title},s._id))}),e.jsxs(y,{onClick:()=>{C||ne(l),U(!C)},className:"shadow-lg hover:shadow-xl transition-shadow",children:[e.jsx(Ne,{className:"me-2 h-4 w-4"}),r(C?"common.cancel":"expenses.addExpense")]})]})]}),Y&&N?.expenses?.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(A,{className:"border-l-4 border-l-blue-500 hover:shadow-lg transition-shadow",children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:r("expenses.totalSpent")}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:M(w.totalSpent,w.currency)})]}),e.jsx(ue,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx(A,{className:"border-l-4 border-l-green-500 hover:shadow-lg transition-shadow",children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:r("expenses.averageExpense")}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:M(w.avgExpense,w.currency)})]}),e.jsx(we,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(A,{className:"border-l-4 border-l-purple-500 hover:shadow-lg transition-shadow",children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:r("expenses.totalExpenses")}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:w.totalCount})]}),e.jsx(me,{className:"h-8 w-8 text-purple-500"})]})})}),e.jsx(A,{className:"border-l-4 border-l-orange-500 hover:shadow-lg transition-shadow",children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:r("expenses.categories")}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:w.categoryData.length})]}),e.jsx(be,{className:"h-8 w-8 text-orange-500"})]})})})]}),Y&&N?.expenses?.length>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[w.monthlyChartData.length>0&&e.jsxs(A,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(re,{children:e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-5 w-5 text-primary"}),r("expenses.monthlySpending")]})}),e.jsx(k,{children:e.jsx(Ie,{width:"100%",height:250,children:e.jsxs(ze,{data:w.monthlyChartData,children:[e.jsx(Be,{strokeDasharray:"3 3"}),e.jsx(Je,{dataKey:"name"}),e.jsx(Xe,{}),e.jsx(Se,{formatter:s=>M(s,w.currency),contentStyle:{borderRadius:"8px"}}),e.jsx(Ye,{dataKey:"amount",fill:"#3b82f6",radius:[8,8,0,0]})]})})})]}),w.categoryData.length>0&&e.jsxs(A,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(re,{children:e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5 text-primary"}),r("expenses.categoryBreakdown")]})}),e.jsx(k,{children:e.jsx(Ie,{width:"100%",height:250,children:e.jsxs(He,{children:[e.jsx(We,{data:w.categoryData,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:t})=>`${s} ${(t*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:w.categoryData.map((s,t)=>e.jsx(Ze,{fill:Ae[t%Ae.length]},`cell-${t}`))}),e.jsx(Se,{formatter:s=>M(s,w.currency),contentStyle:{borderRadius:"8px"}}),e.jsx(Ve,{})]})})})]})]}),e.jsx(cs,{open:C,onOpenChange:s=>{U(s),s||J(null)},children:e.jsx(ds,{className:"max-w-2xl max-h-[90vh] overflow-y-auto p-0 gap-0",children:e.jsxs(A,{className:"border-0 shadow-none",children:[e.jsxs(re,{className:"bg-gradient-to-r from-primary/10 to-purple-500/10 flex flex-row items-center justify-between space-y-0 pb-4",children:[e.jsxs("div",{children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(es,{className:"h-5 w-5 text-primary"}),r(v?"expenses.editExpense":"expenses.addExpense")]}),e.jsx(De,{className:"mt-1",children:m==="equal"?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"h-4 w-4"}),r("expenses.equal")," split among ",x?.length||_?.members?.length||0," members"]}):e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"h-4 w-4"}),r("expenses.custom")," split"]})})]}),e.jsx(y,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0 rounded-full",onClick:ee,"aria-label":"Close",children:e.jsx(Ce,{className:"h-4 w-4"})})]}),e.jsxs(k,{className:"space-y-4 pt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-1",children:[e.jsx(R,{className:"h-4 w-4"}),r("expenses.selectGroup")]}),e.jsx("select",{value:j,onChange:s=>ne(s.target.value),className:"w-full border rounded-md px-3 py-2 bg-background text-sm focus:outline-none focus:ring-2 focus:ring-primary min-w-[200px]",children:Q?.groups?.map(s=>e.jsx("option",{value:s._id,children:s.title},s._id))}),v&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Change group to move this expense to another group. Splits will be recalculated for the new group."})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-1",children:[e.jsx(ue,{className:"h-4 w-4"}),r("expenses.paidBy","Paid by")]}),e.jsx("select",{value:(o.payerId?._id??o.payerId)||D?._id||"",onChange:s=>S({...o,payerId:s.target.value||D?._id}),className:"w-full border rounded-md px-3 py-2 bg-background text-sm focus:outline-none focus:ring-2 focus:ring-primary min-w-[200px]",children:(x?.length?x:_?.members||[]).map(s=>{const t=s.userId._id||s.userId,i=s.userId?.username||"Unknown";return e.jsxs("option",{value:t,children:[i," ",t===D?._id?"(you)":""]},t)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-1",children:[r("expenses.description")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{value:o.description,onChange:s=>S({...o,description:s.target.value}),placeholder:r("expenses.description"),className:"focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-1",children:[r("expenses.amount")," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(G,{type:"number",min:"0.01",step:"0.01",value:o.amount,onChange:s=>{const t=s.target.value;if(S({...o,amount:t}),m==="custom"){const n=(x?.length?x:_?.members||[]).filter(c=>g.some(E=>(E?.toString?.()||E)===((c.userId._id||c.userId)?.toString?.()||c.userId._id))),a=parseFloat(t||0);if(a>0&&n.length){const c=a/n.length;L(n.map(E=>({userId:E.userId._id||E.userId,username:E.userId.username,shareAmount:c.toFixed(2)})))}}},placeholder:"0.00",className:"focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:r("expenses.category")}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{value:B.includes(o.category)?o.category:"Other",onChange:s=>{const t=s.target.value;S({...o,category:t==="Other"?o.category&&!B.includes(o.category)?o.category:"":t})},className:"w-full border rounded-md px-3 py-2 bg-background text-sm focus:outline-none focus:ring-2 focus:ring-primary",children:[B.map(s=>e.jsx("option",{value:s,children:s},s)),e.jsx("option",{value:"Other",children:"Other"})]}),!B.includes(o.category)&&e.jsx(G,{value:o.category,onChange:s=>S({...o,category:s.target.value}),placeholder:"Type custom category",className:"focus:ring-2 focus:ring-primary"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Ge.slice(0,6).map(s=>e.jsx(y,{type:"button",variant:o.category===s?"default":"outline",size:"sm",onClick:()=>S({...o,category:s}),className:"text-xs",children:s},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-1",children:[e.jsx(Ee,{className:"h-4 w-4"}),"Date & Time"]}),e.jsx(G,{type:"datetime-local",value:o.expenseDate,onChange:s=>S({...o,expenseDate:s.target.value}),className:"focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium",children:r("expenses.note")}),e.jsx(G,{value:o.note,onChange:s=>S({...o,note:s.target.value}),placeholder:r("expenses.notePlaceholder"),className:"focus:ring-2 focus:ring-primary"})]})]}),o.amount&&(x?.length||_?.members?.length)&&e.jsxs("div",{className:"space-y-3 pt-4 border-t",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-1",children:[e.jsx(R,{className:"h-4 w-4"}),r("expenses.splitAmong","Split among")]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(y,{type:"button",variant:"outline",size:"sm",onClick:()=>q((x?.length?x:_?.members||[]).map(s=>s.userId._id||s.userId)),children:r("expenses.selectAll","Select all")}),e.jsx(y,{type:"button",variant:"outline",size:"sm",onClick:()=>q([]),children:r("expenses.deselectAll","Deselect all")})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(x?.length?x:_?.members||[]).map(s=>{const t=s.userId._id||s.userId,i=g.some(n=>(n?.toString?.()||n)===(t?.toString?.()||t));return e.jsxs("label",{className:`inline-flex items-center gap-2 px-3 py-2 rounded-lg border cursor-pointer transition-colors ${i?"bg-primary/10 border-primary":"bg-muted/30 border-border hover:bg-muted/50"}`,children:[e.jsx("input",{type:"checkbox",checked:i,onChange:n=>{n.target.checked?q(a=>[...a.filter(c=>(c?.toString?.()||c)!==(t?.toString?.()||t)),t]):q(a=>a.filter(c=>(c?.toString?.()||c)!==(t?.toString?.()||t)))},className:"rounded border-primary"}),e.jsx("span",{className:`w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-medium shrink-0 ${qe(s.userId.username)}`,children:he(s.userId.username)}),e.jsx("span",{className:"text-sm font-medium",children:s.userId.username})]},t)})})]}),o.amount&&(x?.length||H?.members?.length)&&e.jsxs("div",{className:"space-y-3 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium",children:r("expenses.splitType")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(y,{type:"button",variant:m==="equal"?"default":"outline",size:"sm",onClick:()=>X("equal"),className:"transition-all",children:[e.jsx(R,{className:"me-2 h-4 w-4"}),r("expenses.equal")]}),e.jsxs(y,{type:"button",variant:m==="custom"?"default":"outline",size:"sm",onClick:()=>X("custom"),className:"transition-all",children:[e.jsx(pe,{className:"me-2 h-4 w-4"}),r("expenses.custom")]})]})]}),parseFloat(o.amount||0)>0&&g.length>0&&(()=>{const s=parseFloat(o.amount||0),i=(x?.length?x:_?.members||[]).filter(a=>g.some(c=>(c?.toString?.()||c)===((a.userId._id||a.userId)?.toString?.()||a.userId._id))),n=m==="equal"?i.map(a=>({id:a.userId._id||a.userId,name:a.userId?.username||"â€”",share:s/Math.max(1,i.length)})):b.filter(a=>g.some(c=>(c?.toString?.()||c)===(a.userId?.toString?.()||a.userId))).map(a=>({id:a.userId,name:a.username||"â€”",share:parseFloat(a.shareAmount||0)}));return e.jsxs("div",{className:"p-3 rounded-lg bg-muted/30 border border-border space-y-2",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:r("expenses.splitPreview","Split preview")}),e.jsx("div",{className:"space-y-2",children:n.map(a=>{const c=s>0?a.share/s*100:0;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 flex items-center gap-2 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-medium shrink-0 bg-primary/80",children:he(a.name)}),e.jsx("span",{className:"text-sm font-medium truncate",children:a.name})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("div",{className:"w-24 h-2 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full bg-primary transition-all",style:{width:`${Math.min(100,c)}%`}})}),e.jsx("span",{className:"text-sm font-semibold w-16 text-right",children:M(a.share,W)})]})]},a.id)})})]})})(),m==="custom"&&e.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto p-3 bg-muted/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs mb-2",children:[e.jsxs("span",{className:"text-muted-foreground",children:[r("expenses.total"),": ",e.jsx("strong",{children:M(parseFloat(o.amount||0),W)})]}),e.jsxs("span",{className:`font-medium ${z()?"text-green-600":"text-red-600"}`,children:[r("expenses.split"),": ",M(b.reduce((s,t)=>s+parseFloat(t.shareAmount||0),0),W),!z()&&e.jsxs("span",{className:"ms-2",children:["âš  ",r("expenses.amountsDontMatch")]}),z()&&e.jsx(ss,{className:"inline h-4 w-4 ms-1"})]})]}),(x?.length?x:_?.members||[]).filter(s=>g.some(t=>(t?.toString?.()||t)===((s.userId._id||s.userId)?.toString?.()||s.userId._id))).map(s=>{const t=s.userId._id||s.userId,i=b.find(n=>(n.userId?.toString?.()||n.userId)===(t?.toString?.()||t));return e.jsxs("div",{className:"flex items-center gap-3 p-2 border rounded-lg bg-background hover:bg-accent transition-colors",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white text-sm font-medium ${qe(s.userId.username)}`,children:he(s.userId.username)}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-medium",children:s.userId.username})}),e.jsx(G,{type:"number",min:"0",step:"0.01",className:"w-28",value:i?.shareAmount||"0.00",onChange:n=>{const a=b.filter(c=>(c.userId?.toString?.()||c.userId)!==(t?.toString?.()||t));a.push({userId:t,username:s.userId.username,shareAmount:n.target.value}),L(a)}})]},t)})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(y,{onClick:Qe,disabled:!o.description?.trim()||!o.amount||Number(o.amount)<=0||g.length===0||m==="custom"&&!z()||Z.isLoading||V.isLoading,className:"flex-1 shadow-lg hover:shadow-xl transition-shadow",children:Z.isLoading||V.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(xe,{size:"sm",className:"me-2"}),r("common.loading")]}):e.jsxs(e.Fragment,{children:[e.jsx(ts,{className:"me-2 h-4 w-4"}),r(v?"common.save":"expenses.addExpense")]})}),e.jsxs(y,{variant:"outline",onClick:ee,className:"shadow-lg hover:shadow-xl transition-shadow",children:[e.jsx(Ce,{className:"me-2 h-4 w-4"}),r("common.cancel")]})]})]})]})})}),e.jsxs(A,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(re,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ae,{children:r("expenses.title")}),e.jsxs(De,{children:[N?.totalExpenses||0," ",r("expenses.title").toLowerCase()," found"]})]}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>ke(!Y),children:Y?e.jsx(me,{className:"h-4 w-4"}):e.jsx(me,{className:"h-4 w-4"})})]})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(rs,{className:"absolute start-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(G,{placeholder:r("expenses.search"),value:O,onChange:s=>ge(s.target.value),className:"ps-10 focus:ring-2 focus:ring-primary"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{className:"border rounded-md px-3 py-2 bg-background text-sm focus:outline-none focus:ring-2 focus:ring-primary min-w-[150px]",value:F,onChange:s=>{fe(s.target.value),P(1)},children:[e.jsx("option",{value:"",children:r("expenses.allCategories")}),Re.map(s=>e.jsx("option",{value:s,children:s},s))]})})]}),e.jsx("div",{className:"space-y-2",children:Te&&!N?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(xe,{size:"lg"})}):le.length>0?le.filter(s=>!F||s.category===F).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-accent transition-all hover:shadow-md group animate-in fade-in",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-purple-600 rounded-full flex items-center justify-center shadow-md",children:e.jsx("span",{className:"text-white font-bold text-sm",children:s.category?.charAt(0)?.toUpperCase()||"E"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-base",children:s.description}),e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2 mt-1",children:[e.jsx("span",{children:s.category||"General"}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ee,{className:"h-3 w-3"}),ls(s.expenseDate||s.createdAt)]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{className:"flex items-center gap-1",children:[s.splitType==="equal"?e.jsx(R,{className:"h-3 w-3"}):e.jsx(pe,{className:"h-3 w-3"}),s.splitType==="exact"?"custom":s.splitType||"equal"]})]}),s.note&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 italic",children:['"',s.note,'"']})]})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-end",children:[e.jsx("p",{className:"font-bold text-lg",children:M(s.amount,s.currency)}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Paid by ",s.payerId?.username||"Unknown"]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>Le(s),className:"hover:bg-primary/10",children:e.jsx(as,{className:"h-4 w-4"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>{confirm(r("expenses.confirmDelete"))&&Oe.mutate(s._id)},className:"hover:bg-red-50 hover:text-red-600",children:e.jsx(ns,{className:"h-4 w-4"})})]})]})]},s._id)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ue,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-semibold mb-2",children:r("expenses.noResults")}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:O||F?"Try adjusting your search or filters":"Start by adding your first expense"}),!O&&!F&&e.jsxs(y,{onClick:()=>U(!0),className:"shadow-lg",children:[e.jsx(Ne,{className:"me-2 h-4 w-4"}),r("expenses.createFirstExpense")]})]})}),se>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Page ",$," of ",se," â€¢ ",le.length," ",r("common.shown")]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{variant:"outline",size:"sm",disabled:$===1,onClick:()=>P(s=>Math.max(1,s-1)),children:r("common.previous")}),e.jsx(y,{variant:"outline",size:"sm",disabled:$===se,onClick:()=>P(s=>Math.min(se,s+1)),children:r("common.next")})]})]})]})]})]}):e.jsxs("div",{className:"text-center py-16 space-y-4",children:[e.jsx(R,{className:"h-16 w-16 text-muted-foreground mx-auto opacity-50"}),e.jsx("p",{className:"text-lg font-semibold",children:r("expenses.noGroupSelected")}),e.jsx("p",{className:"text-muted-foreground",children:r("expenses.createGroupToStart")})]})};export{gs as default};
