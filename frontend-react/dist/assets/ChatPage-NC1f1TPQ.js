import{u as N,q as b,v as y,r as d,s as u,j as e,$ as v,U as w,z as C,M as _}from"./react-vendor--vquuSlV.js";import{L as G,B as S,C as I,b as q,c as L,a as T,I as k,i as $,j as A,g as x}from"./index-CWe1EfRc.js";import{G as E}from"./GroupChat-DpbK6wlc.js";const Q=()=>{const{t}=N(),m=b(),h=y(),[r,i]=d.useState(null),[o,p]=d.useState(""),{data:f}=u({queryKey:["chat","unread-counts"],queryFn:async()=>(await x.get("/chat/unread-counts")).data.data.unreadCounts||{},refetchInterval:15e3}),{data:n,isLoading:g}=u({queryKey:["groups"],queryFn:async()=>{const s=await x.get("/groups"),a=s.data?.data||s.data;return{groups:Array.isArray(a?.groups)?a.groups:[],pagination:a?.pagination||{}}}}),c=n?.groups?.filter(s=>s.title?.toLowerCase().includes(o.toLowerCase())||s.description?.toLowerCase().includes(o.toLowerCase()))||[],j=n?.groups?.find(s=>s._id===r);return d.useEffect(()=>{const s=n?.groups||[];if(s.length===0||r)return;const a=s[0]._id?.toString()||s[0]._id;i(a)},[n?.groups,r]),g?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(G,{size:"lg"})}):e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(S,{variant:"ghost",size:"sm",onClick:()=>m(-1),className:"rounded-full",children:[e.jsx(v,{className:"h-4 w-4 me-2"}),t("chat.back")]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold",children:t("chat.title")}),e.jsx("p",{className:"text-muted-foreground mt-1",children:t("chat.subtitle")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(I,{className:"border-2 border-border/50 shadow-sm h-[600px] flex flex-col",children:[e.jsxs(q,{className:"pb-3 border-b border-border/50",children:[e.jsxs(L,{className:"text-lg flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5 text-primary"}),t("chat.yourGroups")]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t("chat.chooseGroupToStart")})]}),e.jsxs(T,{className:"flex-1 flex flex-col p-0 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-border/50",children:e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute start-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(k,{placeholder:t("chat.searchGroups"),value:o,onChange:s=>p(s.target.value),className:"ps-10 rounded-lg"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2",children:c.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(_,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-sm",children:t("groups.noGroupsFound")})]}):e.jsx("div",{className:"space-y-2",children:c.map(s=>{const a=s._id?.toString()||s._id,l=f?.[a]||0;return e.jsx("button",{onClick:()=>{i(s._id),l>0&&h.invalidateQueries({queryKey:["chat","unread-counts"]})},className:`w-full text-left p-3 rounded-lg transition-all duration-200 relative ${r===s._id?"bg-primary text-primary-foreground shadow-md":"bg-card border border-border/50 hover:border-primary/50 hover:bg-primary/5"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold text-sm flex-shrink-0 ${r===s._id?"bg-primary-foreground/20":A(s.title)}`,children:$(s.title)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:`font-semibold text-sm truncate ${r===s._id?"text-primary-foreground":"text-foreground"}`,children:s.title}),l>0&&e.jsx("span",{className:"flex-shrink-0 w-5 h-5 rounded-full bg-red-500 text-white text-xs font-bold flex items-center justify-center",children:l>9?"9+":l})]}),e.jsx("p",{className:`text-xs truncate ${r===s._id?"text-primary-foreground/80":"text-muted-foreground"}`,children:t("chat.memberCount",{count:s.memberCount||0})})]})]})},s._id)})})})]})]})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsx(E,{groupId:r||null,groupTitle:j?.title||"",showEditToggle:!0})})]})]})};export{Q as default};
