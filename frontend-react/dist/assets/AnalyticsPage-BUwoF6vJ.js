import{u as P,r as j,s as w,j as e,aq as R,D as _,B,ap as F,W as G}from"./react-vendor--vquuSlV.js";import{u as $,L as A,C as o,b as x,c as u,a as m,e as h,d as S,g as v}from"./index-CWe1EfRc.js";const T=()=>{const{t}=P(),[l,D]=j.useState(""),[f,q]=j.useState("30"),{user:y}=$(),{data:p}=w({queryKey:["groups"],queryFn:async()=>(await v.get("/groups")).data.data}),{data:b}=w({enabled:!!l,queryKey:["analytics-expenses",l,f],queryFn:async()=>{const s=new Date,a=new Date;return a.setDate(a.getDate()-parseInt(f)),(await v.get(`/expenses/${l}?limit=1000&startDate=${a.toISOString()}&endDate=${s.toISOString()}`)).data.data}}),{data:N}=w({enabled:!!l,queryKey:["balances",l],queryFn:async()=>(await v.get(`/settle/${l}/balances`)).data.data}),C=j.useMemo(()=>{if(!N?.balances||!y)return{owe:0,owed:0};const s=N.balances.find(d=>d.userId?._id===y._id||d.userId===y._id);if(!s)return{owe:0,owed:0};const a=s.balance||0;return{owe:a<0?Math.abs(a):0,owed:a>0?a:0}},[N,y]),i=j.useMemo(()=>{if(!b?.expenses)return null;const s=b.expenses,a=s.reduce((n,r)=>n+r.amount,0),d=s.reduce((n,r)=>{const c=r.category||"General";return n[c]=(n[c]||0)+r.amount,n},{}),g=s.reduce((n,r)=>{const c=r.payerId?.username||"Unknown";return n[c]=(n[c]||0)+r.amount,n},{}),I=s.reduce((n,r)=>{const c=new Date(r.createdAt).toLocaleDateString();return n[c]=(n[c]||0)+r.amount,n},{}),O=Object.entries(d).sort((n,r)=>r[1]-n[1]).slice(0,5);return{total:a,count:s.length,average:s.length>0?a/s.length:0,byCategory:d,byPayer:g,byDate:I,topCategories:O}},[b]);return j.useEffect(()=>{!l&&p?.groups?.length&&D(p.groups[0]._id)},[p,l]),p?.groups?.length?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:t("analytics.title")}),e.jsx("p",{className:"text-muted-foreground",children:t("analytics.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("select",{className:"border rounded-md px-3 py-2 bg-background text-sm",value:f,onChange:s=>q(s.target.value),children:[e.jsx("option",{value:"7",children:t("analytics.last7Days")}),e.jsx("option",{value:"30",children:t("analytics.last30Days")}),e.jsx("option",{value:"90",children:t("analytics.last90Days")}),e.jsx("option",{value:"365",children:t("analytics.lastYear")})]}),e.jsx("select",{className:"border rounded-md px-3 py-2 bg-background",value:l,onChange:s=>D(s.target.value),children:p?.groups?.map(s=>e.jsx("option",{value:s._id,children:s.title},s._id))})]})]}),i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(o,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:t("analytics.totalSpent")}),e.jsx(_,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:h(i.total)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[i.count," ",t("analytics.expenses")]})]})]}),e.jsxs(o,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:t("analytics.average")}),e.jsx(B,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:h(i.average)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("analytics.perExpense")})]})]}),e.jsxs(o,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:t("analytics.youOwe")}),e.jsx(F,{className:"h-4 w-4 text-red-600"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold text-red-600",children:h(C.owe)})})]}),e.jsxs(o,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:t("analytics.youAreOwed")}),e.jsx(G,{className:"h-4 w-4 text-green-600"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:h(C.owed)})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(o,{children:[e.jsxs(x,{children:[e.jsx(u,{children:t("analytics.topCategories")}),e.jsx(S,{children:t("analytics.spendingByCategory")})]}),e.jsx(m,{children:e.jsx("div",{className:"space-y-4",children:i.topCategories.map(([s,a],d)=>{const g=a/i.total*100;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:s}),e.jsxs("span",{children:[h(a)," (",g.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all",style:{width:`${g}%`}})})]},s)})})})]}),e.jsxs(o,{children:[e.jsxs(x,{children:[e.jsx(u,{children:t("analytics.byPayer")}),e.jsx(S,{children:t("analytics.whoPaidMost")})]}),e.jsx(m,{children:e.jsx("div",{className:"space-y-3",children:Object.entries(i.byPayer).sort((s,a)=>a[1]-s[1]).slice(0,5).map(([s,a])=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsx("span",{className:"font-medium",children:s}),e.jsx("span",{className:"text-primary font-semibold",children:h(a)})]},s))})})]})]})]}):e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(A,{size:"lg"})})]}):e.jsxs("div",{className:"text-center py-16 space-y-4",children:[e.jsx(R,{className:"h-16 w-16 text-muted-foreground mx-auto"}),e.jsx("p",{className:"text-lg font-semibold",children:t("analytics.noGroups")}),e.jsx("p",{className:"text-muted-foreground",children:t("analytics.createGroup")})]})};export{T as default};
