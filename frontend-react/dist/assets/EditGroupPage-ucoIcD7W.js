import{r as y,j as e,M as J,X as V,aH as W,q as Z,u as ee,v as se,s as z,w as S,$ as Q,aI as k,U as R,aG as re,b as ae,z as _,aE as te,d as ne}from"./react-vendor--vquuSlV.js";import{k as oe,B as p,u as ie,h as de,g as h,L as G,C as j,a as v,b as A,c as M,d as K,i as D,j as O,I as me}from"./index-CWe1EfRc.js";import{G as le}from"./GroupChat-DpbK6wlc.js";const ce=({groupId:n,groupTitle:g})=>{const[r,l]=y.useState(!1);return n?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>l(d=>!d),"aria-label":r?"Close chat":"Open group chat",className:oe("fixed bottom-6 end-6 z-50 flex items-center justify-center","w-14 h-14 rounded-full shadow-lg transition-all duration-200","bg-primary text-primary-foreground hover:bg-primary/90 hover:scale-110","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 focus:ring-offset-background"),children:e.jsx(J,{className:"h-6 w-6"})}),r&&e.jsxs("div",{className:"fixed bottom-24 end-6 z-50 w-[min(calc(100vw-3rem),380px)] rounded-2xl shadow-2xl border border-border bg-card overflow-hidden flex flex-col",style:{height:"min(520px, 75vh)"},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border bg-muted/30",children:[e.jsxs("span",{className:"font-semibold text-foreground truncate",children:[g," â€“ Chat"]}),e.jsx(p,{variant:"ghost",size:"icon","aria-label":"Close chat",className:"shrink-0 rounded-full h-8 w-8 hover:bg-destructive/10 hover:text-destructive",onClick:()=>l(!1),children:e.jsx(V,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:e.jsx(le,{groupId:n,groupTitle:g,showEditToggle:!1,compact:!0})})]})]}):null},ge=()=>{const{id:n}=W(),g=Z(),{t:r}=ee(),{user:l}=ie(),{toast:d}=de(),c=se(),[u,$]=y.useState(""),[I,b]=y.useState([]),{data:t,isLoading:B,error:P}=z({queryKey:["group",n],queryFn:async()=>(await h.get(`/groups/${n}`)).data.data.group,enabled:!!n}),{data:f}=z({queryKey:["friends"],queryFn:async()=>{const s=await h.get("/friends/my");return Array.isArray(s.data)?s.data:[]}});y.useEffect(()=>{if(!f||!Array.isArray(f)){b([]);return}if(u.trim().length===0){b([]);return}const s=u.toLowerCase().trim(),a=f.filter(i=>{const m=i.email?.toLowerCase()||"",C=i.username?.toLowerCase()||"",U=i.firstName?.toLowerCase()||"",E=i.lastName?.toLowerCase()||"",Y=`${U} ${E}`.trim().toLowerCase();return m.includes(s)||C.includes(s)||U.includes(s)||E.includes(s)||Y.includes(s)}),o=t?.members?.map(i=>{const m=i.userId||i;return m._id?.toString()||m.toString()})||[],x=a.filter(i=>{const m=i._id?.toString()||i.id?.toString();return!o.includes(m)});b(x)},[u,f,t]);const L=S({mutationFn:async s=>(await h.post(`/groups/${n}/members`,{userId:s})).data,onSuccess:()=>{d({title:r("notifications.success"),description:r("groups.memberAddedToGroup")}),c.invalidateQueries({queryKey:["group",n]}),c.invalidateQueries({queryKey:["groups"]}),$(""),b([])},onError:s=>{d({variant:"destructive",title:r("common.error"),description:s.response?.data?.message||r("groups.failedToAddMember")})}}),F=S({mutationFn:async s=>(await h.delete(`/groups/${n}/members/${s}`)).data,onSuccess:()=>{d({title:r("notifications.success"),description:r("groups.memberRemovedFromGroup")}),c.invalidateQueries({queryKey:["group",n]}),c.invalidateQueries({queryKey:["groups"]})},onError:s=>{d({variant:"destructive",title:r("common.error"),description:s.response?.data?.message||r("groups.failedToRemoveMember")})}}),T=S({mutationFn:async({userId:s,isAdmin:a})=>(await h.put(`/groups/${n}/members/${s}`,{isAdmin:a})).data,onSuccess:(s,{isAdmin:a})=>{d({title:r("notifications.success"),description:a?r("groups.memberNowAdmin","Member is now admin"):r("groups.adminRoleRemoved","Admin role removed")}),c.invalidateQueries({queryKey:["group",n]}),c.invalidateQueries({queryKey:["groups"]})},onError:s=>{d({variant:"destructive",title:r("common.error"),description:s.response?.data?.message||r("groups.failedToUpdateMember")})}}),H=s=>{L.mutate(s)},X=(s,a)=>{window.confirm(r("groups.removeMemberConfirm",{name:a}))&&F.mutate(s)},q=t?.ownerId?._id?.toString()===l?._id?.toString()||t?.ownerId?.toString()===l?._id?.toString(),N=t?.isAdmin||q;if(B)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(G,{size:"lg"})});if(P||!t)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-red-500 mb-4",children:r("errors.loadingGroup")}),e.jsxs(p,{onClick:()=>g("/groups"),variant:"outline",children:[e.jsx(Q,{className:"me-2 h-4 w-4"}),r("groups.backToGroups")]})]});const w=t.members||[];return e.jsxs("div",{className:"space-y-6 max-w-6xl mx-auto",children:[!N&&e.jsx(j,{className:"border-amber-200 bg-amber-50/50 dark:bg-amber-900/20",children:e.jsxs(v,{className:"py-3 flex items-center gap-2 text-amber-800 dark:text-amber-200 text-sm",children:[e.jsx(k,{className:"h-4 w-4 shrink-0"}),r("groups.onlyAdminsCanEdit","Only group admins can add/remove members and change roles.")]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>g("/groups"),className:"rounded-full",children:[e.jsx(Q,{className:"h-4 w-4 me-2"}),r("common.back")]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:t.title}),e.jsx("p",{className:"text-muted-foreground mt-1",children:t.description||r("groups.noDescription")})]}),q&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-amber-50 dark:bg-amber-900/20 rounded-full",children:[e.jsx(k,{className:"h-4 w-4 text-amber-600 dark:text-amber-400"}),e.jsx("span",{className:"text-sm font-medium text-amber-700 dark:text-amber-300",children:r("groups.owner")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs(j,{className:"border-2 border-border/50 shadow-sm",children:[e.jsx(A,{className:"pb-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs(M,{className:"text-xl flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5 text-primary"}),r("groups.groupMembers")]}),e.jsx(K,{className:"mt-1",children:r("groups.memberCount",{count:w.length})})]})})}),e.jsx(v,{children:w.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(R,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:r("groups.noMembersYet")})]}):e.jsx("div",{className:"space-y-3",children:w.map(s=>{const a=s.userId||s,o=a._id?.toString()||a.toString(),x=t.ownerId?._id?.toString()===o||t.ownerId?.toString()===o,i=l?._id?.toString()===o,m=N&&!x&&!i,C=N&&!x;return e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl bg-gradient-to-r from-background to-muted/20 border border-border/50 hover:border-primary/30 transition-all duration-200 hover:shadow-md",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold text-lg flex-shrink-0 ${O(a.username||a.email||"User")}`,children:D(a.firstName&&a.lastName?`${a.firstName} ${a.lastName}`:a.username||a.email||"U")}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-foreground truncate",children:a.firstName&&a.lastName?`${a.firstName} ${a.lastName}`:a.username||a.email}),x&&e.jsx(k,{className:"h-4 w-4 text-amber-500 flex-shrink-0"}),s.isAdmin&&!x&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-primary/10 text-primary rounded-full",children:r("common.admin")})]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:a.email||a.username})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[C&&e.jsx(p,{variant:"outline",size:"sm",onClick:()=>T.mutate({userId:o,isAdmin:!s.isAdmin}),disabled:T.isLoading,className:"text-xs",children:s.isAdmin?r("groups.removeAdmin","Remove admin"):r("groups.makeAdmin","Make admin")}),m&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>X(o,a.firstName&&a.lastName?`${a.firstName} ${a.lastName}`:a.username||a.email),className:"text-red-500 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg",disabled:F.isLoading,children:e.jsx(re,{className:"h-4 w-4"})})]})]},o)})})})]})}),e.jsxs("div",{className:"space-y-6",children:[N&&e.jsxs(j,{className:"border-2 border-primary/20 shadow-lg bg-gradient-to-br from-primary/5 to-background sticky top-6",children:[e.jsxs(A,{className:"pb-4",children:[e.jsxs(M,{className:"text-xl flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-primary"}),r("groups.addMember")]}),e.jsx(K,{children:r("groups.searchFriendsToAdd")})]}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute start-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(me,{placeholder:r("groups.searchByNameOrEmail"),value:u,onChange:s=>$(s.target.value),className:"ps-10 rounded-lg border-2 focus:border-primary transition-colors"})]}),u.trim().length>0&&e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:I.length>0?I.map(s=>{const a=s._id?.toString()||s.id?.toString(),o=L.isLoading;return e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-card border border-border/50 hover:border-primary/50 hover:bg-primary/5 transition-all duration-200",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-medium text-sm flex-shrink-0 ${O(s.username||s.email||"User")}`,children:D(s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.username||s.email||"U")}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm text-foreground truncate",children:s.firstName&&s.lastName?`${s.firstName} ${s.lastName}`:s.username||s.email}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.email||s.username})]}),e.jsx(p,{size:"sm",onClick:()=>H(a),disabled:o,className:"rounded-lg bg-primary hover:bg-primary/90 text-primary-foreground",children:o?e.jsx(G,{size:"sm"}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-3 w-3 me-1"}),r("common.add")]})})]},a)}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ne,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:r("groups.noFriendsFound")}),e.jsx("p",{className:"text-xs mt-1",children:r("groups.makeSureFriendFirst")})]})}),u.trim().length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(_,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:r("groups.startTypingToSearch")})]})]})]}),e.jsxs(j,{className:"border border-border/50",children:[e.jsx(A,{children:e.jsx(M,{className:"text-lg",children:r("groups.groupInfo")})}),e.jsxs(v,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Type"}),e.jsx("p",{className:"text-foreground",children:t.type||"Other"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Currency"}),e.jsx("p",{className:"text-foreground",children:t.currency||"USD"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Created"}),e.jsx("p",{className:"text-foreground text-sm",children:new Date(t.createdAt).toLocaleDateString()})]})]})]})]})]}),e.jsx(ce,{groupId:n,groupTitle:t.title})]})};export{ge as default};
